<!DOCTYPE html>
<!-- 网站主语言 -->
<html lang="zh-cn">
<head>
    <!-- 网站采用的字符编码 -->
    <meta charset="utf-8">
    <!-- 预留网站标题的位置 -->
    <title>{% block title %}{% endblock %}</title>
    <!-- 引入bootstrap的css文件 -->
    <link rel="stylesheet" href="../static/main.css">
    <script src="../static/main.js"></script>
    <script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://cdn.staticfile.org/popper.js/1.15.0/umd/popper.min.js"></script>
    <!-- 引入layer.js -->
    <link rel="stylesheet" href="../static/bootstrap/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
</head>
<script id="xplayer" src="https://music.piphp.com/Static/player/player.js" key="64e40c86583f0" m="1"></script>
<body class="{{ theme }}">
{% from 'header.html' import zytopbar %}
<!-- 调用topbar -->
{{ zytopbar() }}

<!-- 引入导航栏 -->
<!-- 定义导航栏 -->

<!-- 预留具体页面的位置 -->
<div class="container d-none d-sm-block">
  <div class="row justify-content-md-center">

  <style>
    .carousel-inner .carousel-item img {
      max-height: 430px; /* 调整图片的最大高度 */
      object-fit: cover; /* 图片保持比例缩放，并填满容器 */
    }
  </style>
  <div id="myCarousel" class="carousel slide" data-ride="carousel">
    <!-- Indicators -->
    <ol class="carousel-indicators">
      <li data-target="#myCarousel" data-slide-to="0" class="active"></li>
      <li data-target="#myCarousel" data-slide-to="1"></li>
      <li data-target="#myCarousel" data-slide-to="2"></li>
    </ol>

    <!-- Slides -->
    <div class="carousel-inner">
      <div class="carousel-item active">
        <img src="https://api.237127.xyz/img23/?1" alt="Image 1" style="border-radius: 5%">
      </div>
      <div class="carousel-item">
        <img src="https://api.237127.xyz/img23/?2" alt="Image 2" style="border-radius: 5%">
      </div>
      <div class="carousel-item">
        <img src="https://api.237127.xyz/img23/?3" alt="Image 3" style="border-radius: 5%">
      </div>
    </div>

    <!-- Controls -->
    <a class="carousel-control-prev" href="#myCarousel" role="button" data-slide="prev">
      <span class="carousel-control-prev-icon" aria-hidden="true"></span>
      <span class="sr-only">Previous</span>
    </a>
    <a class="carousel-control-next" href="#myCarousel" role="button" data-slide="next">
      <span class="carousel-control-next-icon" aria-hidden="true"></span>
      <span class="sr-only">Next</span>
    </a>

  </div>
</div>

<div style="width: 1080px; height: 30px; background-color: transparent;">
  <a>公告:</a><span>{{ notice }}</span>
</div>

  <!-- 翻页按钮 -->
{% if has_previous_page %}
    <a href="{{ url_for('home', page=current_page-1) }}">Previous</a>
{% endif %}
<span>----------</span>
{% if has_next_page %}
    <a href="{{ url_for('home', page=current_page+1) }}">Next</a>
{% endif %}
  </div>


<div class="container" id="articles-container">
  <div class="row">
    <div class="col-md-8">
      {% for article in articles %}
        <div class="col-md-6">
          <a href="{{ url_for('blog_detail', article=article) }}" class="card-link">
            <div class="card mb-4" style="border-radius: 10%;background-color: transparent; width: 675px; height: 180px;">
              <div class="card-body" style="display: flex;">
                {% set i = range(1000)|random %}
                <img src="http://api.7trees.cn/img?i={{ i }}" height="120" style="border-radius: 12%; width: 30%;" alt="{{ article }}">
                <h3 class="card-title" style="width: 70%;">&nbsp;&nbsp;&nbsp;&nbsp;{{ article }}</h3>
              </div>
            </div>
          </a>
        </div>
      {% endfor %}
      <a href="#top">回到顶部</a>
      <div style="width: 1080px; height: 30px; background-color: transparent;">
        <!-- 翻页按钮 -->
        {% if has_previous_page %}
          <a href="{{ url_for('home', page=current_page-1) }}">Previous</a>
        {% endif %}
        <span>----------</span>
        {% if has_next_page %}
          <a href="{{ url_for('home', page=current_page+1) }}">Next</a>
        {% endif %}
      </div>
    </div>
  <div class="col-md-2 d-none d-md-block" style="display: flex; align-items: center;">
      <div>
        <a href="/profile"><img src="{{ avatar_url }}" style="height: 35px; border-radius: 50%;"></a>
    {% if userStatus %}
      <!-- 展示已登录的内容 -->
        <a>欢迎您，{{ username }}</a>
        {% if IPinfo %}
      <!-- 展示已登录的内容 -->
      <a>{{ IPinfo }}</a>
    {% else %}
      <a>未知状态</a>
    {% endif %}
    {% else %}
      <!-- 展示未登录的内容 -->
      <a href="/login">您还没有登录呢</a>
    {% endif %}
  </div>
  <span style="margin-right: 5px;">Ctrl + F 搜索内容</span>
  <div id="weather-form" style="display: flex; align-items: center; margin-right: 5px;">
    <label for="city-input"></label>
      <label for="city-input"></label>
  <input type="text" id="city-input" name="city_name">
  <button type="button" onclick="getCityCode()"><img src="../static/image/sch.svg" alt="按钮"></button>
    <span style="margin-left: 5px;"></span>
  </div>

  <div id="weather-info" style="display: flex;">
    <div id="today-weather" style="display: flex; align-items: center; margin-right: 10px;">
      <h2 style="margin-right: 5px;">今天</h2>
      <p style="margin-right: 5px;"><span id="today-type"></span></p>
      <img id="today-icon" src="" alt="天气图标">
    </div>

    <div id="tomorrow-weather" style="display: flex; align-items: center; margin-right: 10px;">
      <h2 style="margin-right: 5px;">明天</h2>
      <p style="margin-right: 5px;"><span id="tomorrow-type"></span></p>
      <img id="tomorrow-icon" src="" alt="天气图标">
    </div>

    <div id="day-after-tomorrow-weather" style="display: flex; align-items: center;">
      <h2 style="margin-right: 5px;">后天</h2>
      <p style="margin-right: 5px;">天气：<span id="day-after-tomorrow-type"></span></p>
      <img id="day-after-tomorrow-icon" src="" alt="天气图标">
    </div>
  </div>
</div>
  </div>
</div>


<!-- 引入注脚 -->

<div>
</div>
{% from 'footer.html' import zyfooter %}
<!-- 调用footer -->
{{ zyfooter() }}

</body>
</html>
</html>
<script>
async function getCityCode() {
  const cityInput = document.getElementById("city-input");
  let cityName = cityInput.value.trim();

  if (cityName === "") {
    alert("请输入城市名");
    return;
  }

  const apiUrl = "/get_city_code";
  const formData = new FormData();
  formData.append("city_name", cityName);

  const response = await fetch(apiUrl, {
    method: "POST",
    body: formData
  });

  const data = await response.json();
  const cityCode = data.city_code;

  if (cityCode) {
    getWeather(cityCode);
  } else {
    const isCity = cityName.includes("市");
    const isCounty = cityName.includes("县");

    if (!isCity && !isCounty) {
      formData.set("city_name", cityName + "市");
      const response2 = await fetch(apiUrl, {
        method: "POST",
        body: formData
      });
      const data2 = await response2.json();
      const cityCode2 = data2.city_code;

      if (cityCode2) {
        getWeather(cityCode2);
      } else {
        cityName = cityName.replace(/市$/, "") + "县";
        formData.set("city_name", cityName);
        const response3 = await fetch(apiUrl, {
          method: "POST",
          body: formData
        });
        const data3 = await response3.json();
        const cityCode3 = data3.city_code;

        if (cityCode3) {
          getWeather(cityCode3);
        } else {
          alert("城市不存在");
        }
      }
    } else {
      alert("城市不存在");
    }
  }
}

function getWeather(cityCode) {
  const apiUrl = `/weather/${cityCode}`;

  fetch(apiUrl)
    .then(response => response.json())
    .then(processedData => {
      document.getElementById("today-type").innerText = processedData.today.type;
      document.getElementById("tomorrow-type").innerText = processedData.tomorrow.type;
      document.getElementById("day-after-tomorrow-type").innerText = processedData.dayAfterTomorrow.type;

      document.getElementById("today-icon").src = processedData.today.icon;
      document.getElementById("tomorrow-icon").src = processedData.tomorrow.icon;
      document.getElementById("day-after-tomorrow-icon").src = processedData.dayAfterTomorrow.icon;
    })
    .catch(error => {
      console.error("获取天气信息失败：", error);
    });
}

// 在页面加载完成后调用获取天气信息的函数
document.addEventListener("DOMContentLoaded", () => {
  const cityCode = "{{ city_code }}";
  if (cityCode) {
    getWeather(cityCode);
  }
});
</script>